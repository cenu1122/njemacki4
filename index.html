<!DOCTYPE html>
<html lang="bs">
<head>
  <meta charset="UTF-8">
  <title>Besplatni Prevodilac Vosk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; max-width: 700px; margin: auto; }
    h1 { text-align: center; }
    textarea { width: 100%; min-height: 120px; padding: 10px; margin-top: 10px; }
    select, button { padding: 10px; margin-top: 10px; }
    button { cursor: pointer; }
    #status { color: green; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>

<h1>ğŸ¤ğŸŒ Besplatni Prevodilac (Vosk)</h1>
<label>Izaberi ulazni jezik:</label><br>
<select id="sourceLang">
  <option value="en">Engleski</option>
  <option value="de">NjemaÄki</option>
</select>
<textarea id="inputText" placeholder="Govori ili upiÅ¡i tekst..."></textarea><br>
<button id="micBtn">ğŸ¤ Govori</button>
<button onclick="translate()">ğŸŒ Prevedi</button>
<h3>Prevod (Bosanski):</h3>
<textarea id="outputText" readonly></textarea>
<button onclick="speak()">ğŸ”Š PresluÅ¡aj prevod</button>
<p id="status"></p>

<script src="https://unpkg.com/vosk-browser/dist/worker.js"></script>
<script src="https://unpkg.com/vosk-browser/dist/vosk.js"></script>
<script>
let recognizer;
let micStream;
const status = document.getElementById('status');

async function initVosk() {
    status.innerText = 'â³ UÄitavam model...';
    await Vosk.init();
    const model = new Vosk.Model('https://alphacephei.com/vosk/models/vosk-model-small-en-us-0.15.zip');
    recognizer = new Vosk.Recognizer(model, 16000);
    status.innerText = 'âœ… Spreman za govor';
}

async function startListening() {
    status.innerText = 'ğŸ¤ PoÄni govoriti...';
    micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioContext.createMediaStreamSource(micStream);
    const processor = audioContext.createScriptProcessor(4096, 1, 1);

    source.connect(processor);
    processor.connect(audioContext.destination);

    processor.onaudioprocess = function(e) {
        const float32Array = e.inputBuffer.getChannelData(0);
        recognizer.acceptWaveform(float32Array);
        const result = recognizer.result();
        if(result.text) {
            document.getElementById('inputText').value = result.text;
        }
    };
}

document.getElementById('micBtn').addEventListener('click', startListening);

async function translate() {
    const text = document.getElementById('inputText').value;
    status.innerText = 'â³ Prevodi se tekst...';
    if(!text){ status.innerText = 'âš  Nema teksta za prevoÄ‘enje.'; return; }
    try{
        const response = await fetch('https://libretranslate.de/translate', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({q:text, source:'auto', target:'bs', format:'text'})
        });
        const data = await response.json();
        document.getElementById('outputText').value = data.translatedText;
        status.innerText = 'âœ… Prevod gotov.';
    } catch(e){
        status.innerText = 'âŒ GreÅ¡ka pri prevoÄ‘enju.';
    }
}

function speak() {
    const text = document.getElementById('outputText').value;
    if(!text){ status.innerText = 'âš  Nema teksta za Äitanje.'; return; }
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang='bs-BA';
    speechSynthesis.speak(utterance);
    status.innerText='ğŸ”Š ÄŒitam prevod...';
}

initVosk();
</script>

</body>
</html>
